<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="utf-8">
    <title>千里之行 始于足下 - ARTS第二十五周</title>
    <meta name="description" content="">
    <meta name="author" content="qianlizhixing">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Le styles -->
    <link href="/theme/bootstrap.min.css" rel="stylesheet">
    <link href="/theme/bootstrap.min.responsive.css" rel="stylesheet">
    <link href="/theme/local.css" rel="stylesheet">
    <link href="/theme/pygments.css" rel="stylesheet">
    <link rel="shortcut icon" href="/theme/images/icons/favicon.ico" type="image/x-icon">
</head>

<body>

    <div class="navbar">
        <div class="navbar-inner">
            <div class="container">

                <a class="btn btn-navbar" data-toggle="collapse" data-target=".nav-collapse">
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                    <span class="icon-bar"></span>
                </a>

                <a class="brand" name="hostpage">千里之行 始于足下</a>

                <div class="nav-collapse">
                    <ul class="nav">
                    </ul>
                </div>

            </div>
        </div>
    </div>

    <div class="container">
        <div class="content">
            <div class="row">

                <div class="span9">
<div class='article'>
    <div class="content-title">
        <h1>ARTS第二十五周</h1>
2021-04-26

<a class="url fn">qianlizhixing</a>


    </div>

    <div><h2>Algorithm</h2>
<p>leetcode 220 存在重复元素III</p>
<ul>
<li><a href="https://leetcode-cn.com/problems/contains-duplicate-iii/">原题</a></li>
<li><a href="https://github.com/qianlizhixing12/coding-training/blob/main/leetcode/220.py">解题</a></li>
<li>保持有序滑动窗口，二分查找</li>
</ul>
<h2>Review</h2>
<blockquote>
<p>https://97-things-every-x-should-know.gitbooks.io/97-things-every-programmer-should-know/content/en/thing_62/</p>
<p>https://97-things-every-x-should-know.gitbooks.io/97-things-every-programmer-should-know/content/en/thing_64/</p>
<p>https://97-things-every-x-should-know.gitbooks.io/97-things-every-programmer-should-know/content/en/thing_68/</p>
</blockquote>
<h3>只有代码代表真相</h3>
<ul>
<li>查看源代码，程序的意义应该是显而易见的；要知道一个程序做什么，源代码最终是您可以确定的</li>
<li>最准确的需求文档也不能说出全部真相，不包含程序实际的详细故事，只包含需求分析人员的高层次意图</li>
<li>使代码尽可能简单，便于阅读和理解</li>
<li>精心设计代码要表达的内容，尽可能直接地传达代码正在做的事</li>
</ul>
<h3>结对编程</h3>
<ul>
<li>作为一名团队成员，要对没有比你有经验的开发者有耐心</li>
<li>直面你对被更熟练的开发人员吓倒的恐惧，要意识到每个人都是不同的，并重视这一点</li>
<li>了解他团队成员的长处和短处，能从同事身上学到东西</li>
</ul>
<h3>版本控制</h3>
<ul>
<li>版本控制之下，可以跟踪历史，查看谁编写了什么代码</li>
<li>可以毫无顾虑地进行大胆的代码更改</li>
<li>将项目的所有资产置于版本控制之下，除了源代码，还包括文档、工具、构建脚本、测试用例、图片，库等</li>
<li>在单独的操作中提交每个逻辑更改，将许多更改集中在一次提交中，以后很难将它们分开</li>
<li>每个提交都附带一条解释信息，至少要简洁地描述您所更改的内容</li>
<li>避免提交会破坏项目构建的代码，否则您将不受项目其他开发人员的欢迎</li>
</ul>
<h2>Tip(dataclass)</h2>
<ul>
<li>python3去掉了__cmp__魔术方法，使用__eq__和__lt__替代</li>
<li>dataclass marshmallow pydantic都实现了ORM功能</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">from</span> <span class="nn">dataclasses</span> <span class="kn">import</span> <span class="n">dataclass</span>
<span class="kn">from</span> <span class="nn">queue</span> <span class="kn">import</span> <span class="n">PriorityQueue</span>


<span class="k">class</span> <span class="nc">Node</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="nf">__cmp__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&gt;=</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span>


<span class="k">class</span> <span class="nc">NodeCmp</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">index</span><span class="p">,</span> <span class="n">value</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">index</span> <span class="o">=</span> <span class="n">index</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">=</span> <span class="n">value</span>

    <span class="k">def</span> <span class="fm">__eq__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__lt__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">other</span><span class="p">):</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span> <span class="o">&lt;</span> <span class="n">other</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="fm">__str__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="sa">f</span><span class="s1">&#39;</span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">value</span><span class="si">}</span><span class="s1"> </span><span class="si">{</span><span class="bp">self</span><span class="o">.</span><span class="n">index</span><span class="si">}</span><span class="s1">&#39;</span>


<span class="nd">@dataclass</span><span class="p">(</span><span class="n">order</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
<span class="k">class</span> <span class="nc">NodeDate</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
    <span class="n">value</span><span class="p">:</span> <span class="nb">int</span>
    <span class="n">index</span><span class="p">:</span> <span class="nb">int</span>


<span class="k">def</span> <span class="nf">main</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="bp">cls</span><span class="p">):</span>
    <span class="n">q</span> <span class="o">=</span> <span class="n">PriorityQueue</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">num</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">nums</span><span class="p">):</span>
        <span class="c1"># q.put(cls(i, num))</span>
        <span class="n">q</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="bp">cls</span><span class="p">(</span><span class="n">num</span><span class="p">,</span> <span class="n">i</span><span class="p">))</span>
    <span class="k">while</span> <span class="ow">not</span> <span class="n">q</span><span class="o">.</span><span class="n">empty</span><span class="p">():</span>
        <span class="nb">print</span><span class="p">(</span><span class="n">q</span><span class="o">.</span><span class="n">get</span><span class="p">())</span>
    <span class="n">obj</span> <span class="o">=</span> <span class="bp">cls</span><span class="p">(</span><span class="s1">&#39;sss&#39;</span><span class="p">,</span> <span class="mi">2</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">obj</span><span class="p">)</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s1">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">nums</span> <span class="o">=</span> <span class="p">[</span><span class="mi">3</span><span class="p">,</span> <span class="mi">6</span><span class="p">,</span> <span class="mi">7</span><span class="p">,</span> <span class="mi">1</span><span class="p">,</span> <span class="mi">5</span><span class="p">,</span> <span class="mi">9</span><span class="p">,</span> <span class="mi">8</span><span class="p">]</span>
    <span class="c1"># main(nums, Node)</span>
    <span class="c1"># TypeError: &#39;&lt;&#39; not supported between instances of &#39;Node&#39; and &#39;Node&#39;</span>
    <span class="c1"># main(nums, NodeCmp)</span>
    <span class="n">main</span><span class="p">(</span><span class="n">nums</span><span class="p">,</span> <span class="n">NodeDate</span><span class="p">)</span>
</code></pre></div>

<h2>Share(socket编程)</h2>
<ul>
<li>socket比较底层，在网络通信中属于网络层(IP/TCP协议)</li>
<li>套接字ip:port标识会话双方</li>
<li>Unix一切皆文件，打开套接字类似打开文件</li>
</ul>
<h3>服务端</h3>
<ul>
<li>打开套接字，指定协议簇(相当约定使用哪种语言)</li>
<li>绑定ip和port，指定身份</li>
<li>准备监听port端口</li>
<li>接受来自port端口的连接请求(阻断)</li>
<li>在连接上接受发送数据</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ThreadPoolExecutor</span><span class="p">,</span> <span class="n">ProcessPoolExecutor</span>


<span class="k">def</span> <span class="nf">init_server</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">):</span>
    <span class="c1"># pool = ThreadPoolExecutor(max_workers=4)</span>
    <span class="n">pool</span> <span class="o">=</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
    <span class="c1"># socket.AF_INET, socket.SOCK_STREAM 协议</span>
    <span class="n">server</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="c1"># 绑定套接字</span>
        <span class="n">server</span><span class="o">.</span><span class="n">bind</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="c1"># 监听</span>
        <span class="n">server</span><span class="o">.</span><span class="n">listen</span><span class="p">(</span><span class="mi">5</span><span class="p">)</span>
        <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
            <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span> <span class="o">=</span> <span class="n">server</span><span class="o">.</span><span class="n">accept</span><span class="p">()</span>
            <span class="c1"># todo 单独放在一个地方处理该对话(线程等)，不阻断其他连接</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">handle_session</span><span class="p">,</span> <span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">)</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">server</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="n">pool</span><span class="o">.</span><span class="n">shutdown</span><span class="p">()</span>


<span class="k">def</span> <span class="nf">handle_session</span><span class="p">(</span><span class="n">conn</span><span class="p">,</span> <span class="n">addr</span><span class="p">):</span>
    <span class="k">while</span> <span class="kc">True</span><span class="p">:</span>
        <span class="c1">#接收数据</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">conn</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="c1"># ?判断客户端是否关闭连接</span>
        <span class="k">if</span> <span class="n">data</span><span class="p">:</span>
            <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;recive </span><span class="si">{</span><span class="n">addr</span><span class="si">}</span><span class="s1">: </span><span class="si">{</span><span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="si">}</span><span class="s1">&#39;</span><span class="p">)</span>
            <span class="c1">#发送数据</span>
            <span class="n">conn</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="n">data</span><span class="o">.</span><span class="n">upper</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">break</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="n">init_server</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span> <span class="mi">8888</span><span class="p">)</span>
</code></pre></div>

<h3>客户端</h3>
<ul>
<li>打开套接字，指定服务端相同协议簇(使用语言)</li>
<li>客户端主动发消息，服务端被动应答，没必要指定客户端绑定的接口，系统随机分配</li>
<li>主动建立连接，指定服务端ip和port</li>
<li>在连接上发送接受数据</li>
</ul>
<div class="highlight"><pre><span></span><code><span class="kn">import</span> <span class="nn">socket</span>
<span class="kn">from</span> <span class="nn">concurrent.futures</span> <span class="kn">import</span> <span class="n">ProcessPoolExecutor</span>


<span class="k">def</span> <span class="nf">init_client</span><span class="p">(</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">,</span> <span class="nb">id</span><span class="p">):</span>
    <span class="n">client</span> <span class="o">=</span> <span class="n">socket</span><span class="o">.</span><span class="n">socket</span><span class="p">(</span><span class="n">socket</span><span class="o">.</span><span class="n">AF_INET</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">SOCK_STREAM</span><span class="p">)</span>
    <span class="k">try</span><span class="p">:</span>
        <span class="n">client</span><span class="o">.</span><span class="n">connect</span><span class="p">((</span><span class="n">host</span><span class="p">,</span> <span class="n">port</span><span class="p">))</span>
        <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;id:</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1"> msg:hello&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recv:&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
        <span class="n">client</span><span class="o">.</span><span class="n">send</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;id:</span><span class="si">{</span><span class="nb">id</span><span class="si">}</span><span class="s1"> msg:world&#39;</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="s1">&#39;utf-8&#39;</span><span class="p">))</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">client</span><span class="o">.</span><span class="n">recv</span><span class="p">(</span><span class="mi">1024</span><span class="p">)</span>
        <span class="nb">print</span><span class="p">(</span><span class="s1">&#39;recv:&#39;</span><span class="p">,</span> <span class="n">data</span><span class="o">.</span><span class="n">decode</span><span class="p">())</span>
    <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s1">&#39;error </span><span class="si">{</span><span class="n">e</span><span class="si">}</span><span class="s1">!&#39;</span><span class="p">)</span>
    <span class="k">finally</span><span class="p">:</span>
        <span class="n">client</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>


<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>
    <span class="k">with</span> <span class="n">ProcessPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">2</span><span class="p">)</span> <span class="k">as</span> <span class="n">pool</span><span class="p">:</span>
        <span class="k">for</span> <span class="nb">id</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">,</span> <span class="mi">4</span><span class="p">):</span>
            <span class="n">pool</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">init_client</span><span class="p">,</span> <span class="n">socket</span><span class="o">.</span><span class="n">gethostname</span><span class="p">(),</span> <span class="mi">8888</span><span class="p">,</span> <span class="nb">id</span><span class="p">)</span>
</code></pre></div>

<h3>demo输出</h3>
<div class="highlight"><pre><span></span><code><span class="c1"># 客户端输出</span>
recv: ID:1 MSG:HELLO
recv: ID:2 MSG:HELLO
recv: ID:1 MSG:WORLD
recv: ID:2 MSG:WORLD
recv: ID:3 MSG:HELLO
recv: ID:3 MSG:WORLD

<span class="c1">#服务端输出</span>
recive <span class="o">(</span><span class="s1">&#39;192.168.3.86&#39;</span>, <span class="m">18384</span><span class="o">)</span>: id:1 msg:hello
recive <span class="o">(</span><span class="s1">&#39;192.168.3.86&#39;</span>, <span class="m">18385</span><span class="o">)</span>: id:2 msg:hellorecive <span class="o">(</span><span class="s1">&#39;192.168.3.86&#39;</span>, <span class="m">18384</span><span class="o">)</span>: id:1 msg:world

recive <span class="o">(</span><span class="s1">&#39;192.168.3.86&#39;</span>, <span class="m">18385</span><span class="o">)</span>: id:2 msg:world
recive <span class="o">(</span><span class="s1">&#39;192.168.3.86&#39;</span>, <span class="m">18398</span><span class="o">)</span>: id:3 msg:hello
recive <span class="o">(</span><span class="s1">&#39;192.168.3.86&#39;</span>, <span class="m">18398</span><span class="o">)</span>: id:3 msg:world
</code></pre></div></div>

    <hr>
</div>
                </div>

                <div class="span3">

                    <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
                        <ul class="nav nav-list">
                            <li class="nav-header">
                                Site
                            </li>

                            <li><a href="/archives.html">Archives</a>
                            <li><a href="/tags.html">Tags</a>
                        </ul>
                    </div>


                    <div class="well" style="padding: 8px 0; background-color: #FBFBFB;">
                        <ul class="nav nav-list">
                            <li class="nav-header">
                                Categories
                            </li>

                            <li><a href="/category/arts.html">ARTS</a></li>
                            <li><a href="/category/cheng-xu-yuan-sheng-ya.html">程序员生涯</a></li>
                        </ul>
                    </div>
                </div>             </div>         </div> 
        <footer>
            <br />
            <p><a name="hostpage">千里之行 始于足下</a> &copy; qianlizhixing 2021</p>
        </footer>

    </div> <!-- /container -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/1.7.1/jquery.min.js"></script>
    <script src="/theme/bootstrap-collapse.js"></script>
    <script>
        document.getElementsByName("hostpage").forEach((item) => {
            item.href = window.location.origin;
        });
    </script>
</body>

</html>